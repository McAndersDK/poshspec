<#
.SYNOPSIS
    Tests Local Anti Malware Properties.
.DESCRIPTION
    Uses Get-MPComputerStatus to check properties of the malware protection status on the local host
.PARAMETER Property
    Specifies a property of the Get-MPComputerStatus return object.    
.PARAMETER Should 
    A Script Block defining a Pester Assertion.       
.EXAMPLE
    MalwareProtection AntispywareEnabled { Should Be True }
.EXAMPLE
    MalwareProtection AMProductVersion { Should BeGreaterThan 4.10.14393.0 }
.EXAMPLE
    MalwareProtection AntivirusSignatureAge { Should BeLassThan 5 }
.NOTES
    Assertions: Be, BeExactly, Exist, Match, MatchExactly
#>
function MalwareProtection {
 
    [CmdletBinding()]
    param(        

        [Parameter(Mandatory, Position=0)]
        [ValidateSet('AMEngineVersion',
                    'AMProductVersion',
                    'AMServiceEnabled',
                    'AMServiceVersion',
                    'AntispywareEnabled',
                    'AntispywareSignatureAge',
                    'AntispywareSignatureLastUpdated',
                    'AntispywareSignatureVersion',
                    'AntivirusEnabled',
                    'AntivirusSignatureAge',
                    'AntivirusSignatureLastUpdated',
                    'AntivirusSignatureVersion',
                    'BehaviorMonitorEnabled',
                    'ComputerID',
                    'ComputerState',
                    'FullScanAge',
                    'FullScanEndTime',
                    'FullScanStartTime',
                    'IoavProtectionEnabled',
                    'LastFullScanSource',
                    'LastQuickScanSource',
                    'NISEnabled',
                    'NISEngineVersion',
                    'NISSignatureAge',
                    'NISSignatureLastUpdated',
                    'NISSignatureVersion',
                    'OnAccessProtectionEnabled',
                    'QuickScanAge',
                    'QuickScanEndTime',
                    'QuickScanStartTime',
                    'RealTimeProtectionEnabled',
                    'RealTimeScanDirection')]
        [string]$Target,
        
        [Parameter(Mandatory, Position=1)]
        [scriptblock]$Should
    )
            
    Process {

        $expression = { Get-MpComputerStatus | Select-Object -ExpandProperty $Target }
        
        $params = Get-PoshspecParam -TestName MalwareProtection -TestExpression $expression @PSBoundParameters
        
        Invoke-PoshspecExpression @params

    }

}
